-build:
  image: quay.io/ukhomeofficedigital/ckan:v1.1.0
  commands:
    - echo "Hello World"
    - cp ckan/configuration/ckan.ini $CKAN_CONFIG/ckan.ini
    - cp ckan/init/ $USER_SCRIPT_DIR
    - cp ckan/plugins $CKAN_PLUGINS
    - yum install -y wget && yum clean all
    - wget -O /tmp/release-1.0.0.tar.gz https://github.com/open-data/ckanext-scheming/archive/release-1.0.0.tar.gz
    - tar -C $CKAN_PLUGINS -xvf /tmp/release-1.0.0.tar.gz 
    - mv $CKAN_PLUGINS/ckanext-scheming-release-1.0.0/ $CKAN_PLUGINS/ckanext-scheming/
    - rm /tmp/release-1.0.0.tar.gz
publish:
  docker:
    registry: quay.io
    username: $$QUAY_USERNAME
    password: $$QUAY_PASSWORD
    email: chris.davidson@digital.homeoffice.gov.uk
    repo: ukhomeofficedigital/data-catalogue
    tag: $$TAG
    file: Dockerfile
    when:
      branch: master
